<!-- Card de Vendas e Lucros -->
<div class="card shadow-lg rounded-4 p-4 mt-4">

  <!-- Cabeçalho -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div class="d-flex align-items-center gap-3">
      <h3 class="m-0 fw-bold text-success d-flex align-items-center">
        <i class="bi bi-bar-chart-line me-2"></i>
        Resumo de Vendas
      </h3>

      <button class="btn btn-outline-success fw-semibold px-4 py-2 rounded-3 shadow-sm d-flex align-items-center gap-2"
        data-bs-toggle="modal" data-bs-target="#modalGraficos">
        <i class="bi bi-graph-up-arrow fs-5"></i>
        Ver Gráficos
      </button>
    </div>

    <div class="modal fade" id="modalGraficos" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content p-3">
          <app-graficos></app-graficos>
        </div>
      </div>
    </div>

    <span class="badge bg-success fs-6 px-3 py-2 shadow-sm">
      Atualizado: {{ dataAtualizacao }}
    </span>
  </div>

  <!-- Indicadores -->
  <div class="row text-center mb-4">
    <div class="col-md-3 mb-2">
      <div class="card shadow-sm border-0 rounded-3 p-3">
        <div class="text-muted fw-semibold">Total Vendido</div>
        <div class="fs-5 fw-bold text-success">{{ formatarMoeda(resumo.totalVendido) }}</div>
      </div>
    </div>

    <div class="col-md-3 mb-2">
      <div class="card shadow-sm border-0 rounded-3 p-3">
        <div class="text-muted fw-semibold">Total Comprado</div>
        <div class="fs-5 fw-bold text-danger">{{ formatarMoeda(resumo.totalComprado) }}</div>
      </div>
    </div>

    <div class="col-md-3 mb-2">
      <div class="card shadow-sm border-0 rounded-3 p-3">
        <div class="text-muted fw-semibold">Lucro Bruto</div>
        <div class="fs-5 fw-bold text-primary">{{ formatarMoeda(resumo.lucroBruto) }}</div>
      </div>
    </div>

    <div class="col-md-3 mb-2">
      <div class="card shadow-sm border-0 rounded-3 p-3">
        <div class="text-muted fw-semibold">Margem de Lucro</div>
        <div class="fs-5 fw-bold text-warning">{{ resumo.margemLucro | number:'1.1-2' }}%</div>
      </div>
    </div>
  </div>

  <!-- Tabela de Vendas -->
  <div class="card shadow-sm border-0 rounded-3">
    <div class="card-header bg-success text-white d-flex justify-content-between align-items-center flex-wrap gap-2">

      <span class="fw-semibold">
        <i class="bi bi-clipboard-data me-2"></i>Vendas
      </span>

      <div class="d-flex gap-2 flex-wrap">

        <select class="form-select w-auto bg-light border-0 shadow-sm fw-semibold" [(ngModel)]="categoriaSelecionada"
          (change)="filtrarVendas()">
          @for (cat of categorias; track $index) {
          <option [ngValue]="cat">{{ cat | titlecase }}</option>
          }
        </select>

        <select class="form-select w-auto bg-light border-0 shadow-sm fw-semibold" [(ngModel)]="mesSelecionado"
          (change)="filtrarVendas()">
          <option [ngValue]="'todos'">Todos Meses</option>
          @for (m of meses; track $index) {
          <option [ngValue]="m.valor">{{ m.nome }}</option>
          }
        </select>

        <select class="form-select w-auto bg-light border-0 shadow-sm fw-semibold" [(ngModel)]="anoSelecionado"
          (change)="filtrarVendas()">
          <option [ngValue]="'todos'">Todos Anos</option>
          @for (ano of anos; track $index) {
          <option [ngValue]="ano">{{ ano }}</option>
          }
        </select>

      </div>

    </div>

    <div class="card-body p-0">

      <table class="table table-hover align-middle mb-0">
        <thead class="table-light fw-bold">
          <tr class="small">
            <th>Categoria</th>
            <th>Descrição do Produto</th>
            <th>Forma de Pagamento</th>
            <th>Valor de Venda(R$)</th>
            <th>Quantidade</th>
            <th>Lucro(R$)</th>
            <th>Data de Venda</th>
          </tr>
        </thead>

        <tbody>
          @for (venda of vendasPaginadas; track venda.id) {
          <tr>

            <td class="py-3 px-4 fw-bold text-dark">
              <span class="badge border px-3 py-2" [ngClass]="{
                'bg-red-light text-red border-red': venda.categoria === 'Carnes',
                'bg-yellow-light text-yellow border-yellow': venda.categoria === 'Bebidas',
                'bg-green-light text-green border-green': venda.categoria === 'Doces',
                'bg-blue-light text-blue border-blue': venda.categoria === 'Frios',
                'bg-purple-light text-purple border-purple': venda.categoria === 'Temperos'
              }">
                {{ venda.categoria }}
              </span>
            </td>

            <td class="py-3 px-4 fw-semibold text-dark">
              {{ venda.produto }}
              <div class="small text-muted mt-1">{{ venda.marca }}</div>
            </td>
            <td class="fw-semibold">{{ venda.formaPagamento }}</td>
            <td>{{ formatarMoeda(venda.precoVenda) }}</td>
            <td>{{ venda.quantidadeVendida }}</td>
            <td>{{ formatarMoeda(venda.lucro?? 0) }}</td>
            <td class="py-3 px-4 text-muted">{{ venda.dataVenda | date:'dd/MM/yyyy' }}</td>
          </tr>
          } @empty {
          <tr>
            <td colspan="7" class="text-center py-5 text-muted fs-6">
              Nenhum produto encontrado
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
  </div>

  <!-- Paginação elegante (compacta) -->
  <nav aria-label="Navegação da Tabela" class="mt-4">
    <ul class="pagination justify-content-center mb-4 gap-1">

      <!-- ANTERIOR -->
      <li class="page-item" [class.disabled]="paginaAtual === 1">
        <button class="page-link rounded-circle px-3 py-2"
          (click)="irParaPagina(paginaAtual - 1)"
          aria-label="Anterior">
          <i class="bi bi-chevron-left"></i>
        </button>
      </li>

      <!-- PÁGINAS (compactas + ...) -->
      <li class="page-item"
          *ngFor="let pagina of paginasVisiveis; trackBy: trackByIndex"
          [class.active]="paginaAtual === pagina && pagina !== -1">

        <!-- Página normal -->
        <ng-container *ngIf="pagina !== -1; else pontos">
          <button class="page-link rounded-circle px-3 py-2"
            (click)="irParaPagina(pagina)"
            [ngClass]="{
              'bg-primary text-white': paginaAtual === pagina,
              'text-primary': paginaAtual !== pagina
            }">
            {{ pagina }}
          </button>
        </ng-container>

        <!-- Reticências -->
        <ng-template #pontos>
          <span class="page-link border-0 text-muted">
            ...
          </span>
        </ng-template>
      </li>

      <!-- PRÓXIMO -->
      <li class="page-item" [class.disabled]="paginaAtual === totalPaginas">
        <button class="page-link rounded-circle px-3 py-2"
          (click)="irParaPagina(paginaAtual + 1)"
          aria-label="Próximo">
          <i class="bi bi-chevron-right"></i>
        </button>
      </li>

    </ul>
  </nav>
</div>
